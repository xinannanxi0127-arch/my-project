# 病理图像炎症区域检测工具

这是一个基于 Python 和 OpenCV 的病理图像分析工具，可以自动检测并标注炎症损伤严重的区域。

## 功能特点

- 自动识别病理切片中的炎症区域
- 基于颜色（紫色/紫红色）和细胞密度进行检测
- 用红色箭头标注最严重的炎症区域
- 生成调试图像显示检测过程
- 批量处理多张图像

## 安装步骤

### 1. 确保已安装 Python

检查 Python 版本（需要 Python 3.8 或更高版本）：

```bash
python --version
```

### 2. 安装依赖库

在项目文件夹中运行：

```bash
pip install -r requirements.txt
```

或者手动安装：

```bash
pip install opencv-python numpy matplotlib
```

## 使用方法

### 1. 准备图像

将您的病理切片图像放入 `input_images` 文件夹中。

支持的格式：JPG, JPEG, PNG, BMP, TIFF

### 2. 运行分析

```bash
cd 病理探究
python pathology_analyzer.py
```

### 3. 查看结果

标注后的图像会保存在 `output_images` 文件夹中：
- `annotated_*.jpg` - 标注了红色箭头的结果图像
- `debug_*.jpg` - 包含检测过程的调试图像

## 检测原理

该工具基于以下病理学特征进行检测：

1. **颜色分析**：炎症区域通常呈现深紫色/紫红色（细胞密集染色）
2. **密度检测**：高密度细胞浸润区域（暗色区域）
3. **区域面积**：过滤掉过小的噪声区域
4. **严重程度评分**：结合颜色强度和区域大小

## 调整参数

如果需要调整检测效果，可以修改 `pathology_analyzer.py` 中的参数：

```python
# 在 main() 函数中：
analyzer.process_all_images(
    max_arrows=5,      # 每张图最多标注几个区域（1-10）
    show_debug=True    # 是否生成调试图像
)

# 在 find_severe_regions() 方法中：
min_area=500           # 最小区域面积（像素），增大可减少误报
```

## 注意事项

⚠️ **重要提醒**：

1. 本工具仅用于辅助研究和教学，**不能用于临床诊断**
2. 自动检测结果应由专业病理医生审核确认
3. 不同染色方法和扫描设备可能需要调整检测参数
4. 建议先用少量图像测试效果，再批量处理

## 项目结构

```
病理探究/
├── pathology_analyzer.py    # 主程序
├── requirements.txt          # 依赖库列表
├── README.md                 # 使用说明
├── input_images/             # 输入图像文件夹（放置原始图像）
└── output_images/            # 输出图像文件夹（自动生成结果）
```

## 常见问题

**Q: 检测不到炎症区域怎么办？**

A: 可以尝试：
- 调整颜色范围参数（HSV 值）
- 降低 `min_area` 阈值
- 检查图像是否为 HE 染色（该工具针对 HE 染色优化）

**Q: 标注的区域不准确怎么办？**

A: 这是正常的，因为：
- 炎症判定需要专业知识，算法只能辅助
- 建议将此工具作为初筛工具，由医生最终判定
- 可以根据您的具体需求调整检测参数

**Q: 可以用于其他类型的病理图像吗？**

A: 可以，但可能需要修改代码中的颜色范围和检测逻辑，以适应不同的染色方法和组织类型。

## 技术支持

如有问题，请检查：
1. Python 版本是否 >= 3.8
2. 所有依赖库是否正确安装
3. 图像文件是否放在正确的文件夹中
4. 图像格式是否支持
